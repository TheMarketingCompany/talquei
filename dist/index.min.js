!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Talquei={})}(this,(function(t){"use strict";var e={functional:!0,props:{vnodes:{type:[Array,Object],required:!0}},render:(t,{props:e})=>{const s=e.vnodes;return Array.isArray(s)?s:t(s)}},s=(t,e,s)=>{if(!["text","select"].includes(e.tag))throw new Error("[talquei] Invalid input type");if("select"===e.tag&&!e.options)throw new Error("[talquei] You must pass some items to select");const i=e=>{t.$_next(),t.$emit(s.event,e)};return{name:"InputForm",directives:{focus:{inserted:t=>t.focus()}},render(s){let n;const o=s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"16px",height:"16px",fill:"currentColor"}},[s("path",{attrs:{d:"M277.375 427V167.296l119.702 119.702L427 256 256 85 85 256l29.924 29.922 119.701-118.626V427h42.75z"}})]);if("text"===e.tag){const{tag:r,...l}=e;n=[s("input",{class:["talquei-form__text"],attrs:{type:"text",...l},ref:"text",directives:[{name:"focus"}]}),(a=()=>this.$refs.text.value,s("button",{class:"talquei-form__submit",attrs:{type:"submit"},on:{click:()=>i(a())}},t.$_submitSlot?t.$_submitSlot:[o]))]}else if("select"===e.tag){const t=Object.keys(e.options);n=[s("div",{class:["talquei-form__select"]},t.map((t,n)=>s("button",{attrs:{type:"button"},class:"talquei-form__select__item",on:{click:()=>i(e.options[t])},directives:[0===n?{name:"focus"}:{}]},e.options[t])))]}var a;return s("form",{class:"talquei-form",on:{submit:t=>{t.preventDefault(),t.stopPropagation()}}},n)}}};function i(t,e,s,i,n,o,a,r,l,d){"boolean"!=typeof a&&(l=r,r=a,a=!1);const u="function"==typeof s?s.options:s;let c;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,n&&(u.functional=!0)),i&&(u._scopeId=i),o?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},u._ssrRegister=c):e&&(c=a?function(t){e.call(this,d(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,r(t))}),c)if(u.functional){const t=u.render;u.render=function(e,s){return c.call(s),t(e,s)}}else{const t=u.beforeCreate;u.beforeCreate=t?[].concat(t,c):[c]}return s}const n=i({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.isEnabled&&(t.text||t.isUser)?s("div",{staticClass:"talquei-message",class:t.isUser?"talquei-message--user":"talquei-message--app"},[s("div",{staticClass:"talquei-message__avatar"},[t.isUser?t._e():s("div",[t.$_avatarSlot?s("VNodes",{attrs:{vnodes:t.$_avatarSlot}}):s("span",[t._v("\n        ðŸ¤–\n      ")])],1)]),t._v(" "),s("div",{staticClass:"talquei-message__text"},[s("Transition",{attrs:{name:"talquei--fade",mode:"out-in",duration:t.isUser?50:600},on:{"after-leave":t.onAfterLeave}},[t.isPending?s("span",{key:"pending",staticClass:"talquei--blink talquei-message__text__pending"},[t._v("\n        â€¦\n      ")]):s("span",{key:"text"},[t._v("\n        "+t._s(t.formattedText)+"\n      ")])])],1)]):t._e()},staticRenderFns:[]},void 0,{name:"TalqueiMessage",components:{VNodes:e},inject:{$_next:"next",$_showInput:"showInput",$_avatarSlot:"avatarSlot",$_submitSlot:"submitSlot",$_scrollToTerminal:"scrollToTerminal"},model:{prop:"text",event:"input"},props:{input:{type:Object,required:!1,default:void 0},isUser:{type:Boolean,required:!1,default:!1},text:{type:String,required:!1,default:void 0},template:{type:String,required:!1,default:"{text}"}},data:()=>({isEnabled:!1,isPending:!0}),computed:{hasInput(){return!!this.$slots.default||!!this.input},formattedText:{cache:!1,get(){return this.template.replace("{text}",this.text)}}},watch:{isEnabled(t){t&&(this.renderInput(),this.isUser||this.showText())},text:{handler(t){t&&this.isEnabled&&this.showText()},immediate:!0},isPending(t){t||!this.isEnabled||this.hasInput||setTimeout(()=>this.$_next(),1500)}},methods:{renderInput(){setTimeout(()=>{if(this.$slots.default)this.$_showInput(this.$slots.default);else if(this.input){const t=s(this,this.input,this.$options.model);this.$_showInput(t)}},500)},showText(){this.isUser?this.isPending=!1:setTimeout(()=>this.isPending=!1,500)},onAfterLeave(){setTimeout(()=>this.$_scrollToTerminal(),100)},run(){this.isEnabled=!0}}},void 0,!1,void 0,!1,void 0,void 0,void 0),o=(t,e)=>{"function"==typeof t.scroll?t.scroll({top:t.scrollHeight,behavior:e?"smooth":"instant"}):t.scrollTop=t.scrollHeight};const a=i({render:function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"talquei"},[e("div",{directives:[{name:"scroll-down",rawName:"v-scroll-down"}],ref:"terminal",staticClass:"talquei-terminal"},[this._t("default")],2),this._v(" "),this.inputNode?e("div",{staticClass:"talquei-inputbar"},[e("VNodes",{attrs:{vnodes:this.inputNode}})],1):this._e()])},staticRenderFns:[]},void 0,{name:"Talquei",directives:{"scroll-down":{bind:(t,e)=>{let s=!1;t.addEventListener&&t.addEventListener("scroll",()=>{s=t.scrollTop+t.clientHeight+1<t.scrollHeight}),new MutationObserver(i=>{const n=e.value||{};!1===n.always&&s||1!==i[i.length-1].addedNodes.length||o(t,n.smooth)}).observe(t,{childList:!0,subtree:!0})},inserted:o}},provide(){return{avatarSlot:this.$slots.avatar,submitSlot:this.$slots.submit,next:this.next,showInput:this.showInput,scrollToTerminal:this.scrollToTerminal}},components:{VNodes:e},props:{autoRun:{type:Boolean,required:!1,default:!0}},data:()=>({step:void 0,inputNode:void 0,messages:[]}),computed:{totalSteps(){return this.messages.length}},watch:{step(t){this.inputNode=void 0,this.runMessage(this.messages[t])}},mounted(){this.autoRun&&this.init()},updated(){this.scrollToTerminal()},methods:{scrollToTerminal(){o(this.$refs.terminal)},init(){this.collectMessages(),this.step=0},next(){this.inputNode=void 0,this.collectMessages();const t=this.step+1;t<this.totalSteps?setTimeout(()=>this.step=t,500):this.emitComplete()},emitComplete(){this.$emit("complete")},showInput(t){this.inputNode=t},collectMessages(){this.messages=this.$children.filter(t=>t.$options.name===n.name)},runMessage(t){t&&t.run()}}},void 0,!1,void 0,!1,void 0,void 0,void 0);function r(t){t.component(a.name,a),t.component(n.name,n)}"undefined"!=typeof window&&window.Vue&&window.Vue.use(r),t.Talquei=a,t.TalqueiMessage=n,t.default=r,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
